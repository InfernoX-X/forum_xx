<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contribute | <%= siteTitle %></title>
    <link rel="icon" href="<%= favIcon %>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #F93742;
            --bg: #000;
            --surface: #111;
            --border: #222;
            --text-main: #FFF;
            --text-muted: #888;
            --input-bg: #080808;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg); color: var(--text-main); font-family: 'Inter', sans-serif; line-height: 1.5; }
        
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .page-header { margin-bottom: 40px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .page-header h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; }
        .page-header p { color: var(--text-muted); }

        /* Grid Layout */
        .contribute-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 40px; align-items: start; }

        @media (max-width: 900px) {
            .contribute-grid { grid-template-columns: 1fr; }
        }

        /* Common Form Styles */
        .card { background: var(--surface); border: 1px solid var(--border); padding: 30px; border-radius: 8px; }
        .card h3 { font-size: 0.75rem; color: var(--accent); letter-spacing: 2px; margin-bottom: 20px; text-transform: uppercase; }
        
        label { display: block; font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; font-weight: 700; }
        .container input, textarea, select { 
            width: 100%; background: var(--input-bg); border: 1px solid var(--border); 
            color: #fff; padding: 12px; margin-bottom: 18px; border-radius: 4px; font-family: inherit;
        }
        .container input:focus, textarea:focus, select:focus { border-color: var(--accent); outline: none; }

        .btn-accent { 
            background: var(--accent); color: #fff; border: none; padding: 12px 30px; 
            font-weight: 700; border-radius: 4px; cursor: pointer; transition: 0.2s; width: 100%;
        }
        .btn-accent:hover { filter: brightness(1.2); }

        /* Multi-select Forum Container */
        .forum-selection-container {
            max-height: 250px; overflow-y: auto; background: var(--input-bg);
            padding: 15px; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 18px;
        }
        .category-group-header {
            background: #1a1a1a; color: var(--accent); font-size: 0.65rem;
            font-weight: 800; padding: 4px 10px; margin: 10px 0 8px 0;
            border-left: 3px solid var(--accent); text-transform: uppercase;
        }
        .forum-item {
            display: flex; align-items: center; gap: 8px; font-size: 0.8rem;
            cursor: pointer; padding: 5px; color: #ccc;
        }
        .forum-item:hover { background: #151515; color: #fff; }
        .forum-item input[type="checkbox"] { width: auto; margin: 0; accent-color: var(--accent); }

        /* File Upload */
        .file-label { 
            display: inline-block; background: #222; padding: 10px 15px; border-radius: 4px; 
            font-size: 0.75rem; cursor: pointer; border: 1px solid var(--border); margin-bottom: 18px;
        }
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .hidden-item {
            display: none !important;
        }

        /* Optional: Make the search input stand out slightly */
        #tagSearchInput {
            border-color: #333;
            background: #000;
        }
        #tagSearchInput:focus {
            border-color: var(--accent);
        }
    </style>
</head>
<body>

<%- include("../partials/navBar") %>

<div class="container">
    <header class="page-header">
        <h1>CONTRIBUTE</h1>
        <p>Expand the community by sharing new content or creating new tags.</p>
    </header>

    <div class="contribute-grid">
        
        <section class="card">
            <h3>Create New Content</h3>
            <form action="/forum/posts/create" method="post" enctype="multipart/form-data">
                <label>Video Title</label>
                <input type="text" name="title" placeholder="Original Title with (Female Performer's name)" required>

                <label>Target Categories</label>
                <div class="tag-search-wrapper" style="margin-bottom: 10px;">
                    <input type="text" id="tagSearchInput" placeholder="Quick find category..." 
                        style="font-size: 0.8rem; padding: 8px; margin-bottom: 0;">
                </div>
                <div class="forum-selection-container">
                    <% let currentHeader = ""; %>
                    <% allForums.forEach(f => { %>
                        <% if (f.header !== currentHeader) { 
                            currentHeader = f.header; %>
                            <div class="category-group-header"><%= currentHeader %></div>
                        <% } %>
                        <label class="forum-item" data-name="<%= f.title.toLowerCase() %>">
                            <input type="checkbox" name="forumIds" value="<%= f.id %>">
                            <%= f.title %>
                        </label>
                    <% }) %>
                </div>

                <label>Body Content</label>
                <textarea name="content" rows="4" placeholder="Detailed description..."></textarea>

                <label>Full Video Link (Any Site)</label>
                <input type="text" name="url" placeholder="Full Video Link">
                
                <label for="post-image" class="file-label" id="main-file-label">ðŸ“Ž ATTACH IMAGE</label>
                <input type="file" id="post-image" name="image" accept="image/*" style="display:none" 
                       onchange="document.getElementById('main-file-label').innerText = 'ðŸ“‚ ' + this.files[0].name">

                <button type="submit" class="btn-accent">PUBLISH!</button>
            </form>
        </section>

        <section class="card">
            <h3>Start a Category</h3>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 20px;">
                Couldn't find the tag, Create New tag!
            </p>
            <form action="/forum/create" method="post">
                <label>Category Title</label>
                <input type="text" name="title" placeholder="e.g. Lesbian / Straight" required>
                
                <label>Short Bio / Intro</label>
                <input type="text" name="bio" placeholder="Small intro for tag" required>
                
                <label>Parent Header</label>
                <select name="header">
                    <% forums.forEach(header => { %>
                        <option value="<%= header.name %>"><%= header.name %></option>
                    <% }) %>
                </select>

                <button type="submit" class="btn-accent" style="background: #333;">CREATE CATEGORY</button>
            </form>
        </section>

    </div>
</div>

<script>
    document.getElementById('tagSearchInput').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        const container = document.querySelector('.forum-selection-container');
        const items = container.querySelectorAll('.forum-item');
        const headers = container.querySelectorAll('.category-group-header');

        // 1. Filter the individual forum items
        items.forEach(item => {
            const tagName = item.getAttribute('data-name') || "";
            if (tagName.includes(searchTerm)) {
                item.classList.remove('hidden-item');
            } else {
                item.classList.add('hidden-item');
            }
        });

        // 2. Hide headers that no longer have visible items following them
        headers.forEach(header => {
            let nextEl = header.nextElementSibling;
            let hasVisibleChild = false;

            // Check all siblings until the next header or end of container
            while (nextEl && !nextEl.classList.contains('category-group-header')) {
                if (nextEl.classList.contains('forum-item') && !nextEl.classList.contains('hidden-item')) {
                    hasVisibleChild = true;
                    break;
                }
                nextEl = nextEl.nextElementSibling;
            }

            if (hasVisibleChild) {
                header.classList.remove('hidden-item');
            } else {
                header.classList.add('hidden-item');
            }
        });
    });
</script>

</body>
</html>