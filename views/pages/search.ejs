<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search: <%= searchKey %> | <%= siteTitle %></title>
    <link rel="icon" href="<%= favIcon %>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<style>
    :root {
        --accent: #F93742;
        --bg: #000;
        --surface: #111;
        --border: #222;
        --text-main: #FFF;
        --text-muted: #888;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: var(--bg); color: var(--text-main); font-family: 'Inter', sans-serif; line-height: 1.5; }

    .container { max-width: 1000px; margin: 60px auto; padding: 0 20px; }

    /* Search Header */
    .search-header {
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border);
    }
    
    .search-header h1 { font-size: 1.8rem; font-weight: 800; }
    .search-header span { color: var(--accent); }

    /* Post Cards */
    .post-card { 
        background: var(--surface); 
        border: 1px solid var(--border); 
        border-radius: 8px; 
        margin-bottom: 30px; 
        padding: 25px; 
    }
    
    .post-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 15px; 
        border-bottom: 1px solid #222; 
        padding-bottom: 10px; 
    }
    
    .post-author { color: var(--accent); font-weight: 700; font-size: 0.9rem; }
    .post-time { color: var(--text-muted); font-size: 0.8rem; }

    .delete-btn { 
        background: transparent; 
        border: none; 
        color: var(--text-muted); 
        font-size: 1.8rem; 
        cursor: pointer; 
        line-height: 1; 
    }
    .delete-btn:hover { color: var(--accent); }

    .post-display-title { font-size: 1.6rem; margin-bottom: 10px; font-weight: 700; }
    .post-display-text { color: #ccc; margin-bottom: 15px; font-size: 1rem; }
    .post-display-link { color: var(--accent); text-decoration: none; font-size: 0.85rem; display: block; margin-bottom: 15px; word-break: break-all; }

    /* Images - Full Width & High Quality */
    .popUpClass { width: 100%; cursor: pointer; margin-top: 15px; border-radius: 4px; overflow: hidden; }
    .post-display-image { 
        width: 100%; 
        max-height: 700px; 
        object-fit: contain; 
        background: #080808; 
        display: block; 
        border: 1px solid #222; 
    }

    /* Empty State */
    .no-results {
        text-align: center;
        padding: 100px 20px;
        color: var(--text-muted);
    }
    .no-results h2 { color: #fff; margin-bottom: 10px; }
</style>

<body>
<%- include("../partials/navBar") %>

<div class="container">

    <div class="search-header">
        <h1>SEARCH RESULTS FOR: <span><%= searchKey %></span></h1>
    </div>

    <div id="posts-feed">
        <% if (posts.length > 0) { %>
            <% for (const post of posts) { %>
                <div class="post-card">
                    <div class="post-header">
                        <div>
                            <span class="post-author"><%= post.username %></span> 
                            <span class="post-time">‚Ä¢ <%= timeAgo(post.created_at) %></span>
                        </div>

                        <% if (user && user.id === post.user_id) { %>
                            <form action="/forum/posts/delete/<%= post.id %>" method="POST" style="display:inline;">
                                <input type="hidden" name="forum_id" value="<%= post.forum_id %>">
                                <button type="submit" class="delete-btn" onclick="return confirm('Delete this post?')">&times;</button>
                            </form>
                        <% } %>
                    </div>

                    <h2 class="post-display-title"><%= post.title %></h2>
                    <p class="post-display-text" style="text-transform: none;"><%= post.content %></p>
                    
                    <% if (post.url) { %>
                        <a href="<%= post.url %>" class="post-display-link" target="_blank">üîó <%= post.url %></a>
                    <% } %>

                    <div class="popUpClass">
                        <img src="<%= post.image %>" loading="lazy" class="post-display-image" alt="Post Image">
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="no-results">
                <h2>No matches found</h2>
                <p>Try searching for a different keyword or username.</p>
                <br>
                <a href="/forum" style="color: var(--accent); text-decoration: none; font-weight: bold;">‚Üê Back to Forum</a>
            </div>
        <% } %>
    </div>
</div>

<%- include("../partials/imageViewer") %>

<script>
    // Initialize gallery if function exists
    if (typeof initializeImageGallery === "function") {
        initializeImageGallery("popUpClass");
    }
</script>

</body>
</html>